language: java

sudo: required

notifications:
email: james.hn.sears@gmail.com

addons:
  sonarcloud:
    organization: "jameshnsears-github"
    token:
      secure: "RLJhHL5ADcB6omJhtIo5Z82glu/CMWfaxG0pzrNXcciNUQPlWnro5qKuVFwFuu96Ku/KVYO91grnWi2Q77EA0QPSU2bxfBwahWea5DBLaisS829mNFB2mUiIV1hlZhbSrg5zzz3e5h3JdBARy5nqdB4NIRG5wPXq1rNJ5zQf+aeacUeZpUP8OoCMnS7VDhdwGLTa/lmHs7A1+kTdZj3DryvEoPAsvG3ojJP1fyN4m2bxO5aq8Cexqv3V9hQs2g+z5NvHjC94gwIHiWAb6QeZGdey0ZfP8LGKWPDDNRcmthLxXzjKKhmNXYFgpXsL3CFzqdwhFtvIZOfmr9HhGh3Pic110jfMDcTE5De+QYCxM/fx/Ghqemb+NGqs9DTUS8V3I9iFYC7jictVKKI779mlwXg+YUZatUCQ800s3m2VmnRrjc/fz/Lyk533N9qk1w6n23r177grHDUngxw8y2t1M3ASlvDNbhAioxqrfqGj4UTpH2/qHFS/8yCnUfuQ8nmAkyq9hQCLFEQngeXjKTS7k9oRnGHZQOuRaauM6Tg4eyQXYlBlQrWGQeiv8FQMGfHnXyBzV6zNPvGDh+KjIe4Pf0arXaG7//YAX8r9GYK1XmCsmkQ8VMgKTJsaCDB0DSrNqsFzyL25f9jSSBX3I4nMVrlZJr+4o2w82rbJuWjkJmk="

services:
  - docker

jdk:
  - openjdk11

cache:
  directories:
    - $HOME/.m2
    - $HOME/.sonar/cache

before_script:
  - sudo service postgresql stop
  - while sudo lsof -Pi :5432 -sTCP:LISTEN -t; do sleep 1; done

script:
  - docker-compose up -d xqa-db xqa-message-broker xqa-ingest-balancer
  - docker-compose up -d --scale xqa-shard=2
  - mvn clean test
  - mvn checkstyle:check spotbugs:check pmd:pmd

after_success:
  - mvn jacoco:report coveralls:report
  - sonar-scannert
