language: java

sudo: required

notifications:
email: james.hn.sears@gmail.com

addons:
  sonarcloud:
    organization: "jameshnsears-github"
    token:
      secure: "XwUFX8/52MnV+zTUszl4NPA6/8JcKiAJKS6K1xpXIBB9B/Kmp0BDOQFXEzBukMtu/HMTdJjNpqzMYtu9i9p8Wz3c0Va0/T0qVEDpAeyVhO9RCdP21U6duhAg2Ji9M9HmCo/HYQm4CMb/o2Sm93/TUJ3MXuY7f811XoVg0eQf3p5rI6cHBIKVwpU9OY+/VmeRaUkf5fjYvNWY7FFvtIY+BSsYRdIql9EaerPh2lrQCBkpPIgSYY2MwItu0sZQxCrztL/LRS/5kne5qUBukn2A1DeRyHWPBu/tgk5ORFGgEGenNjLeqwd41k4WUSB/61e3VSpvicVVx0drE398boA65/2zPEuA8HvsdtumF7GdL5ifmoA0pIn02BJ+J/ZwZ7Be+YG6UkUGjUeuUqopxmIcT547M4cdWeA0Xzj+xg7gWvYJNNLO7XqxV+9IaiFv3BNyaUR3kMj7Fn7sIFDTUFxSx3mTDZTnmiI74X+a3jiAmDl0VzVWR7JZUdCMQVZOUs+jeC8Dh5QOpg93vsQ1+iGWNLLxNRKqfEgfg1t/5Xjsa/lhcDjhZ06wO00OyDSi7iUsuETNnr4wkqThmGWSYrUMxAmzRkOg19b2zsh31FHLNMkt3iPRF+6Jh/2IMMWAzGtjQOeAloWOZNLHP8G24MR7JWaL3va9CGVr58WlqC0vvuk="

git:
  depth: false

services:
  - docker

jdk:
  - openjdk10

cache:
  directories:
    - $HOME/.m2
    - $HOME/.sonar/cache

before_script:
  - sudo service postgresql stop
  - while sudo lsof -Pi :5432 -sTCP:LISTEN -t; do sleep 1; done

script:
  - docker-compose up -d xqa-db xqa-message-broker xqa-ingest-balancer
  - docker-compose up -d --scale xqa-shard=2
  - mvn clean test
  - mvn checkstyle:check spotbugs:check pmd:pmd

after_success:
  - mvn jacoco:report coveralls:report
  - sonar-scanner
